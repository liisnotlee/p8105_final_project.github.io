---
title: "Regression Model"
output: html_document
date: "2025-12-01"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include = FALSE}
library(tidyverse)
library(janitor)
library(broom)
```
## Data Cleaning 
#### Pulling datasets needed and merging into one to prepare for regression analysis 
```{r} 
subject_info_raw = read.csv("clean_data/subject_info.csv")
all_daily_raw = read.csv("clean_data/all_daily_data.csv")

#Adding a category simplifying race that will only be used for regression analysis 
subject_info = subject_info_raw %>%
  mutate(
    race_category = case_when(
      ethnicity %in% c("East Asian", "South Asian", "Southeast Asian") ~ "Asian",
      ethnicity == "White" ~ "White",
      TRUE ~ "Other"),
    race_category = factor(
      race_category, levels = c("Asian", "White", "Other")))

#creating a menstruation binary variable in all_daily
all_daily = all_daily_raw %>%
  mutate(menstruation = factor(if_else(phase == "menstrual", 1, 0),
                          levels = c(0, 1),
                          labels = c("No", "Yes")))

#Creating a merged data frame 
merged_df = all_daily %>%
  left_join(subject_info, by = "id", relationship = "many-to-many")
```
This section leverages the same cleaned data set used in other parts of this analysis. For further simplification with regression, two new variables were created - `race_simplified`, which collapses specific ethnicity categories into broader racial groups (any with a count < 3 was put into other if there was not an applicable category already). Additionally, for simplicity of running the regression focusing on solely menstrual symptoms, a binary variable reporting `menstruation` as "no" (0) or "yes" (1) was created. `merged_df` was created to easily run both demographic and daily data through a regression model. 

## Running basic model to identify significant symptoms
#### Identified symptoms that were significant with mensturation at p<0.05 or less 
```{r}
symptom_model = glm(
  menstruation ~ fatigue_score + cramps_score + sleepissue_score + exerciselevel_score + appetite_score + bloating_score + moodswing_score + indigestion_score + sorebreasts_score, 
  data = merged_df,
  family = binomial())

summary(symptom_model)
symptom_model = tidy(symptom_model)

#This section does physiology model - do we still need it? Removing if so 
physiology_model = glm(menstruation ~ estrogen + lh, 
                       data = merged_df, 
                       family=binomial())

summary(physiology_model)
physiology_model = tidy(physiology_model)
```
We ran a binomial regression between menstruation and self-reported symptoms. The results of our preliminary regression analysis show that menstruation was positively associated with `fatigue`, `cramps`, and `bloating`. There was a negative association with reported between menstruation and `sleep issues`. 


## Demographic and Lifestyle Factors and Symptoms 
#### Focusing on symptoms that were reported as statistically significant 
```{r}
#Fatigue and Demographic/Lifestyle Factors
fatigue_model = glm( 
  fatigue_score ~ total_active_min + sleep_score + stress_score + education_abrv + race_category + bmi + age, data = merged_df)

summary(fatigue_model)

#Cramps and Demographic/Lifestyle Factors
cramps_model = glm( 
  cramps_score ~ total_active_min + sleep_score + stress_score + education_abrv + race_category + bmi + age, data = merged_df)

summary(cramps_model)

#Bloating and Demographic/Lifestyle Factors
bloating_model = glm( 
  bloating_score ~ total_active_min + sleep_score + stress_score + education_abrv + race_category + bmi + age, data = merged_df)

summary(bloating_model)

#Sleep Issues and Demographic/Lifestyle Factors 
sleepissues_model = glm( 
  sleepissue_score ~ total_active_min + sleep_score + stress_score + education_abrv + race_category + bmi + age, data = merged_df)

summary(sleepissues_model)
```

Interestingly, some self-reported that might be expected to be linked with related quantitative variables were not positively associated. For example, self-reported fatigue and self-reported sleep issues were not significantly associated with the quantitative variable sleep score that aggregated bio metric data on sleep quality. 

Limitations to this data set as a whole also apply to the significance and generalization of this regression analysis. For example, the small sample size is a limitation and could be exaggerating the influence of some demographic factors on symptoms. Furthermore, with the population being largely comprised of young, white or Asian participants, these results may not be generalizable to a more diverse population. 