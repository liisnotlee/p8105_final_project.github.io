---
title: "HORMONES & SYMPTOMS: STATISTICAL MODELLING"
output:
  html_document:
    code_folding: hide 
---
```{r, include=FALSE}
library(tidyverse)
library(broom)
library(broom.mixed)
library(lme4)
# Set plot theme
theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.discrete.colour = function(...) scale_colour_brewer(..., palette = "Pastel2"),
  ggplot2.discrete.fill   = function(...) scale_fill_brewer(..., palette = "Pastel2"),
```



```{r, message=FALSE, warning = FALSE, include=FALSE}


# Load packages 
library(tidyverse)
library(ggplot2)
library(modelr)
library(mgcv)
library(dplyr)
library(tidyr)
library(patchwork)
library(lme4)
library(lmerTest)
library(gt)
library(ggsci)
library(knitr)
library(broom.mixed) # for tidy
library(scales)

# Set plot theme
theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.discrete.colour = function(...) scale_colour_brewer(..., palette = "Pastel2"),
  ggplot2.discrete.fill   = function(...) scale_fill_brewer(..., palette = "Pastel2"),

  ggplot2.continuous.colour = function(...) scale_colour_distiller(..., palette = "PuRd"),
  ggplot2.continuous.fill   = function(...) scale_fill_distiller(..., palette = "PuRd")
)

hormone_symptoms=
  read_csv("clean_data/hormone_symptoms.csv")|>
  janitor::clean_names()|>
  filter(!is.na(phase) & !is.na(moodswing) & !is.na(fatigue)& !is.na(flow_color)& !is.na(flow_volume)& !is.na(appetite))
```

# Hormone and Symptoms
## Mood Swing Linear Mixed Models


Test whether mood swing differ by menstrual phase, accounting for repeated measures.

```{r, warning= FALSE}

mood_mixed_model <- lmer(moodswing_score ~ phase + (1 | id), data = hormone_symptoms)


create_model_table <- function(model, model_name) {
  # Get tidy output
  tidy_output <- tidy(model, effects = "fixed", conf.int = TRUE)
  
  # Extract p-values from model summary
  p_values <- summary(model)$coefficients[, ncol(summary(model)$coefficients)]
  
  # Create the table
  table <- tidy_output %>%
    select(term, estimate, std.error, conf.low, conf.high) %>%
    mutate(
      p.value = p_values[match(term, names(p_values))],
      significant = ifelse(p.value < 0.05, "Yes", "No"),
      model = model_name
    ) %>%
    select(model, everything())
  
  return(table)
}
mood_table = create_model_table(mood_mixed_model, "Mood Swing ~ Phase")|>
  knitr::kable(digits = 3)
mood_table


```


Based on the model results, the average mood swing score during the menstrual phase (the model intercept) is 1.77. Compared to this, symptoms are modestly lower in other phases, with the follicular phase showing the largest reduction of 0.37 points, followed by the fertility window at 0.34 points lower, and the luteal phase at 0.24 points lower. However, the analysis reveals that individual differences between participants are substantial; the random effects standard deviation of 0.98 for participant baselines is nearly identical to the residual standard deviation of 1.00, indicating that the unique baseline score of an individual accounts for as much variance in the data as all other unmeasured factors and the cycle phases combined. Therefore, while a statistically significant pattern links the menstrual phase to higher symptom reports, the predominant finding is the extensive variability from person to person, underscoring that the experience of cycle-related mood swings is highly individual. 

## Flow volume vs LH
Observing in exploratory scatter plots that self-reported flow volume scores appeared to follow an inverse pattern relative to luteinizing hormone (LH) levels, I conducted a linear mixed model analysis to formally test this visual hypothesis. The model was used to determine if this apparent inverse relationship was statistically significant when rigorously accounting for the repeated measures within each individual participant.

```{r, warning= FALSE}
flow_volume_model <- lmer(flow_volume_score ~ lh + (1 | id), data = hormone_symptoms)

flow_table <- create_model_table(flow_volume_model, "Flow Volume ~ LH")|>
  knitr::kable(digits = 3)
flow_table
```
Based on the linear mixed model, a significant but modest relationship exists between luteinizing hormone (LH) levels and perceived menstrual flow volume. For every one-unit increase in LH, the flow volume score is estimated to decrease by -0.01138 points (p = 0.00129). While statistically significant, this effect is small in magnitude. The model indicates substantial individual differences, as the variation in scores within a single person over time (residual SD = 1.19) is much greater than the average differences between individuals' baselines (intercept SD = 0.45). Therefore, while LH shows a significant inverse association with flow volume, within-person biological and measurement variability remains the dominant feature of the data.

## Appetite vs Estrogen

After observing in a scatter plot that average moodswing scores appeared to follow estrogen patterns, I applied a linear mixed model to appetite to formally test whether estrogen levels directly predict its changes within individuals.

```{r, warning= FALSE}
appetite_model <- lmer(appetite_score ~ estrogen + (1 | id), data = hormone_symptoms)
appetite_table <- create_model_table(appetite_model, "Appetite ~ Estrogen")|>
  knitr::kable(digits = 3)
appetite_table
```

Based on the linear mixed-effects model, the analysis finds no statistically significant relationship between measured estrogen levels and self-reported appetite scores in this dataset. The model estimates that for every one-unit increase in estrogen, the appetite score increases by a mere 0.0001137 points, an effect size so small as to be negligible. This relationship is not reliable, as indicated by a p-value of 0.402, which is far above the conventional threshold for significance. The model estimates the average appetite score when estrogen is zero to be 2.897 points. More notably, the random effects structure reveals that differences between individuals account for meaningful variation; the standard deviation of individual baseline scores is 0.415, while the standard deviation of the within-person residuals is 0.726. This indicates that while people have different typical appetite levels, the unexplained variation within a person's own measurements over time is nearly twice as large as the differences between individuals, and estrogen, as modeled here, does not explain a significant portion of that within-person fluctuation.


