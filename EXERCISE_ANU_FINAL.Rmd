---
title: "EXERCISE: FINAL ANALYSIS"
author: "Anu Singh"
date: "2025-12-01"
output: html_document
---

# Libraries required
```{r, message = FALSE}
library(tidyverse)
library(knitr)
```

# Data import and cleaning
This analysis combines exercise tracking data with hormone and self-reported symptom data to examine relationships between physical activity and menstrual cycle phases. The exercise data was first cleaned by removing duplicate entries and selecting relevant variables including exercise duration, active time, and heart rate. Individual exercise sessions were then aggregated to the daily level, with duration variables converted from milliseconds to minutes. Daily summaries include total exercise duration, total active minutes, average heart rate, and number of exercise sessions per day. The hormone and self-reported symptom data was cleaned by converting all Likert scale responses (ranging from "Very Low/Little" to "Very High") to numeric values from 1 to 5 for quantitative analysis. Menstrual cycle phases were ordered chronologically (Menstrual, Follicular, Fertility, Luteal) as an ordered factor variable to ensure proper sequencing during analyses.

```{r, message = FALSE, warning = FALSE}
# Read data
exercise = read_csv("./data/exercise.csv")
hormones = read_csv("./data/hormones_and_selfreport.csv")


# Clean and de-duplicate exercise data
exercise_clean = exercise %>%
  distinct() %>%
  select(id, study_interval, start_day_in_study, activityname, duration, activeduration, averageheartrate)

# Aggregate to daily level
exercise_daily = exercise_clean %>%
  group_by(id, study_interval, start_day_in_study) %>%
  summarise(
    total_duration_min = sum(duration, na.rm = TRUE) / 60000,
    total_active_min = sum(activeduration, na.rm = TRUE) / 60000,
    avg_heartrate = mean(averageheartrate, na.rm = TRUE),
    n_sessions = n(),
    .groups = "drop"
  ) %>%
  rename(day_in_study = start_day_in_study)

# Convert Likert scales to numeric
likert_to_num = c("Very Low/Little" = 1, "Low" = 2, "Moderate" = 3, 
                   "High" = 4, "Very High" = 5)

hormones_clean = hormones %>%
  mutate(
    # Convert all symptoms to numeric
    headaches_num = recode(headaches, !!!likert_to_num),
    cramps_num = recode(cramps, !!!likert_to_num),
    sorebreasts_num = recode(sorebreasts, !!!likert_to_num),
    fatigue_num = recode(fatigue, !!!likert_to_num),
    sleepissue_num = recode(sleepissue, !!!likert_to_num),
    moodswing_num = recode(moodswing, !!!likert_to_num),
    stress_num = recode(stress, !!!likert_to_num),
    foodcravings_num = recode(foodcravings, !!!likert_to_num),
    indigestion_num = recode(indigestion, !!!likert_to_num),
    bloating_num = recode(bloating, !!!likert_to_num),
    appetite_num = recode(appetite, !!!likert_to_num),
    
    # Order phase factor
    phase = factor(phase, 
                   levels = c("Menstrual", "Follicular", "Fertility", "Luteal"))
    )

# Merge datasets
merged_data = hormones_clean %>%
  left_join(exercise_daily, by = c("id", "study_interval", "day_in_study")) %>%
  mutate(
    # Replace NA with 0 for days without exercise
    total_duration_min = replace_na(total_duration_min, 0),
    total_active_min = replace_na(total_active_min, 0),
    n_sessions = replace_na(n_sessions, 0),
    
    # Did they exercise today?
    exercised_today = ifelse(n_sessions > 0, 1, 0)
  ) %>%
  
  # Remove individuals with no phase
  filter(!is.na(phase))
```

# EDA
```{r}

```


# Modelling and inferential analysis
```{r}

```

