---
title: "MULTIVARIATE MODELLING"
---

This section leverages the same cleaned data set used in other parts of this analysis. For further simplification with regression, two new variables were created - `race_simplified`, which collapses specific ethnicity categories into broader racial groups (any with a count < 3 was put into other if there was not an applicable category already). Additionally, for simplicity of running the regression focusing on solely menstrual symptoms, a binary variable reporting `menstruation` as "no" (0) or "yes" (1) was created. `merged_df_model` was created to easily run both demographic and daily data through a regression model. 
```{r, include=FALSE}
# Loading libraries
library(tidyverse)
library(lme4)
library(lmerTest)
library(broom.mixed)
library(knitr)

sleep_stress_daily <- read.csv("./clean_data/sleep_stress_daily.csv")
hormone_symptoms <- read.csv("./clean_data/hormone_symptoms.csv")
exercise_daily <- read.csv("./clean_data/exercise_daily.csv")

subject_info <- read.csv("./clean_data/subject_info.csv") |>
  mutate(
    race_category = case_when(
      ethnicity %in% c("East Asian", "South Asian", "Southeast Asian") ~ "Asian",
      ethnicity == "White" ~ "White",
      TRUE ~ "Other"),
    race_category = factor(race_category, levels = c("Asian", "White", "Other"))
  )

all_daily_data <- hormone_symptoms |> 
  # MERGE exercise & hormone
  left_join(exercise_daily, by = c("id", "study_interval", "day_in_study")) |>
  # add flag exercised_flag for easy filtering in the future analyses
  # only need to keep exercised_flag==1 to have all rows with exercise data
  mutate(
    exercised_flag = ifelse(!is.na(n_sessions) & n_sessions > 0, 1, 0),
    menstruation = factor(if_else(phase == "menstrual", 1, 0),
                          levels = c(0, 1),
                          labels = c("No", "Yes"))
  ) |> 
  # MERGE sleep & stress score data
  # noticed hormone_symptoms df has a stress_score column 
  # drop it
  select(-stress_score) |> 
  left_join(sleep_stress_daily, by = c("id", "study_interval", "day_in_study")) |> 
  # add flag sleep_stress_flag for easy filtering in the future analyses
  mutate(
    sleep_stress_flag = ifelse(
      !is.na(stress_score) & !is.na(sleep_score),1,0
    )
  )

merged_df_model = all_daily_data %>%
  left_join(subject_info, by = "id", relationship = "many-to-many")

symptom_model = glmer(
  menstruation ~ fatigue_score + cramps_score + sleepissue_score + exerciselevel_score + appetite_score + bloating_score + moodswing_score + indigestion_score + sorebreasts_score + (1 | id), data = merged_df_model, family = binomial)

summary(symptom_model)
symptom_model_table = tidy(symptom_model) %>%
  select(-group, -effect) %>%
  kable()


physiology_model = glmer(
  menstruation ~ estrogen + lh + (1 | id), data = merged_df_model, family=binomial())

summary(physiology_model)
physiology_model_table = tidy(physiology_model) %>%
  select(-group, -effect) %>%
  kable()
```

```{r}
#Symptom Model Table
symptom_model_table

#Hormone Model Table
physiology_model_table
```

We ran a binomial regression between menstruation and self-reported symptoms. The results of our preliminary regression analysis show that menstruation was positively associated with `fatigue`, `cramps`, and `bloating`. There was a negative association between menstruation and reported `sleep issues` and `sore breasts` as well as measured `estrogen` and `luteinizing hormone (lh)`. 

#### Demographic and Lifestyle Factors and Symptoms 
##### Focusing on symptoms that were reported as statistically significant 
```{r, include=FALSE}
#Fatigue and Demographic/Lifestyle Factors
fatigue_model = lmer( 
  fatigue_score ~ total_active_min + sleep_score + stress_score + education_abrv + race_category + bmi + age + lh + estrogen + (1 | id), data = merged_df_model, REML = FALSE)

summary(fatigue_model)
fatigue_model_table = tidy(fatigue_model) %>%
  select(-group, -effect) %>%
  kable() 

#Cramps and Demographic/Lifestyle Factors
cramps_model = lmer( 
  cramps_score ~ total_active_min + sleep_score + stress_score + education_abrv + race_category + bmi + age + lh + estrogen + (1 | id), data = merged_df_model, REML = FALSE)

summary(cramps_model)
cramps_model_table = tidy(cramps_model) %>%
  select(-group, -effect) %>%
  kable()

#Bloating and Demographic/Lifestyle Factors
bloating_model = lmer( 
  bloating_score ~ total_active_min + sleep_score + stress_score + education_abrv + race_category + bmi + age + lh + estrogen + (1 | id), data = merged_df_model, REML = FALSE)

summary(bloating_model)
bloating_model_table = tidy(bloating_model) %>%
  select(-group, -effect) %>%
  kable()

#Sleep Issues and Demographic/Lifestyle Factors 
sleepissues_model = lmer( 
  sleepissue_score ~ total_active_min + sleep_score + stress_score + education_abrv + race_category + bmi + age + lh + estrogen + (1 | id), data = merged_df_model, REML = FALSE)

summary(sleepissues_model)
sleepissues_model_table = tidy(sleepissues_model) %>%
  select(-group, -effect) %>%
  kable()

#Sore Breasts and Demographic/Lifestyle factors 
sorebreasts_model = lmer( 
  sorebreasts_score ~ total_active_min + sleep_score + stress_score + education_abrv + race_category + bmi + age + lh + estrogen + (1 | id), data = merged_df_model, REML = FALSE)

summary(sorebreasts_model)
sorebreasts_model_table = tidy(sorebreasts_model) %>%
  select(-group, -effect) %>%
  kable()
```

```{r}
#Fatigue Model Table
fatigue_model_table

#Bloating Model Table
bloating_model_table

#Sleep Issues Model Table
sleepissues_model_table

#Sore Breasts Model Table
sorebreasts_model_table

#Cramps Model Table
cramps_model_table
```
We found that self-reported fatigue was positively associated with having the educational attainment of High School (p < 0.001) or Some College (p < 0.001) compared to Bachelor's degree or higher. We found fatigue was negatively associated with being in the "Other" racial category, which was a broad category comprising of hispanic, african, and middle eastern participants. (p < 0.001) There was also a correlation between higher BMI and fatigue (p < 0.05), as well as stress_score and fatigue (p < 0.05). 

We found that bloating was negatively associated with Race being white (p < 0.001) or other (p < 0.001). We also found that bloating was positively associated with educational attainment of high school (p < 0.01) or college (p < 0.001). Furthermore, we found bloating was positively associated with BMI (p < 0.001) and negatively associated with estrogen (p < 0.05). 

We found sleep issues to be positively associated with an educational attainment of high school (p < 0.001) or college (p < 0.001). Furthermore, we found that there was a positive association between higher BMI and reported sleep issues (p < 0.001). We found sleep issues to be negatively associated with being categorized in the "other" race category (p < 0.001). 

We found sore breasts to be only positively associated with older age (p < 0.01). We did not find cramping symptoms to be associated with any biometric or demographic characteristic. 