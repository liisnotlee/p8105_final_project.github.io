---
title: "SLEEP & STRESS STATISTICAL MODELLING"
output:
  html_document:
    code_folding: hide 
---

<br>

In this analysis, we examine how sleep quality and stress levels fluctuate across menstrual cycle phases, and whether sleep metrics predict stress.

<br>

```{r setup , include = FALSE}
library(tidyverse)
library(ggplot2)
library(modelr)
library(mgcv) # for cross validation
library(dplyr)
library(tidyr)
library(patchwork)
library(lme4)
library(lmerTest)
library(rstatix)
library(ggpubr)
library(FSA)# for Dunn test
library(broom.mixed) # for tidy

set.seed(1)

# Set plot theme
theme_set(theme_minimal() + 
            theme(legend.position = "bottom",
                  axis.title = element_text(size = 14),
                  axis.text = element_text(size = 12)))
options(
  ggplot2.discrete.colour = function(...) scale_colour_brewer(..., palette = "Pastel2"),
  ggplot2.discrete.fill   = function(...) scale_fill_brewer(..., palette = "Pastel2"),

  ggplot2.continuous.colour = function(...) scale_colour_distiller(..., palette = "PuRd"),
  ggplot2.continuous.fill   = function(...) scale_fill_distiller(..., palette = "PuRd")
)
```

Our dataset are from two studies in two different times, year 2022 and year 2024 in which the 2024 cohort is a subset from 2022 cohorts. Therefore the assumptions of independence is violated so we cannot use statistical tests that required independence assumptions. 
Instead, we used generalized linear mixed effects model to evaluate the significant different of stress score and sleep score between menstrual phases. 

A linear mixed-effects model was fitted to examine the association between menstrual cycle phase and stress score, with menstrual phase as the reference category and participant included as a random intercept. The results showed that stress scores during the follicular phase did not differ significantly from the menstrual phase (estimate = 0.291, SE = 0.213, p = 0.172). In contrast, stress scores were significantly lower during the fertility (ovulatory) phase (estimate = –0.594, SE = 0.211, p = 0.005) and the luteal phase (estimate = –0.525, SE = 0.198, p = 0.008) compared with the menstrual phase.

Because higher scores reflect lower perceived stress, these negative estimates indicate that participants experienced more stress during both the fertility and luteal phases relative to the menstrual phase. Overall, the model suggests meaningful fluctuations in stress across the menstrual cycle, with perceived stress notably increased during the fertility and luteal phases.


```{r,message=FALSE, warning=FALSE}
m1 = lmer(stress_score ~ phase +(1 | id), data = sleep_stress_df)
tidy(m1, effects = "fixed", conf.int = TRUE)|>
  select(term, estimate, std.error,p.value, conf.low, conf.high) |>
  mutate(
  significant = ifelse(p.value < 0.05, "Yes", "No")) |>
  knitr::kable(
    title = "Linear mixed effect models for stress score variation by menstrual phases",
    digits = 3)
```
A linear mixed-effects model was used to evaluate differences in sleep scores across menstrual cycle phases, with the menstrual phase serving as the reference category and participant modeled as a random intercept. The results showed significant reductions in sleep score during all non-menstrual phases. Compared with the menstrual phase, sleep scores were significantly lower during the follicular phase (estimate = –1.037, SE = 0.283), the fertility (ovulatory) phase (estimate = –1.342, SE = 0.281), and the luteal phase (estimate = –1.126, SE = 0.263), with all effects statistically significant (p < 0.001).

Because higher scores reflect better sleep quality, these negative estimates indicate that participants slept worse during the follicular, fertility, and luteal phases compared with the menstrual phase. The largest decrease in sleep score occurred during the fertility phase, suggesting that ovulation is associated with the poorest sleep quality. Overall, the model demonstrates that sleep quality varies systematically across the menstrual cycle, with the menstrual phase representing the period of highest sleep quality.


```{r,message=FALSE, warning=FALSE}
m2 = lmer(sleep_score ~ phase +(1 | id), data = sleep_stress_df)
tidy(m2, effects = "fixed", conf.int = TRUE)|>
  select(term, estimate, std.error,p.value, conf.low, conf.high) |>
  mutate(
  significant = ifelse(p.value < 0.05, "Yes", "No")) |>
  knitr::kable(digits = 3)
```

```{r}
m3 = lmer(timeinbed_mean ~ phase +(1 | id), data = sleep_stress_df)
tidy(m3, effects = "fixed", conf.int = TRUE)|>
  select(term, estimate, std.error,p.value, conf.low, conf.high) |>
  mutate(
  significant = ifelse(p.value < 0.05, "Yes", "No")) |>
  knitr::kable(digits = 3)
```

With an estimate of 0.032 and a p-value of 0.043 (which is less than the typical significance level of 0.05), this variable is a significant positive predictor of stress score. This suggests that, on average, for every additional minute of deep sleep, the stress score is predicted to increase by 0.032 points, assuming other variables are constant. Time in bed is a is a significant positive predictor of stress score ( p = 0.013) For every additional minute in bed (mean), the stress score is predicted to increase by 0.009 points, holding all other variables constant. The 95% confidence intervals for the significant predictors (deep_sleep_in_minutes and timeinbed_mean) do not contain zero, further supporting their statistical significance. When we explore more variables, the menstrual phases do not affect the stress score significantly. 

```{r, message=FALSE, warning=FALSE}
#  model
m4 <- lmer(stress_score ~ phase + deep_sleep_in_minutes +
           timeinbed_mean + total_active_min + moodswing_score +(1 | id), data = sleep_stress_df)
tidy(m4, effects = "fixed", conf.int = TRUE)|>
  select(term, estimate, std.error, conf.low, conf.high,p.value) |>
  mutate(
  significant = ifelse(p.value < 0.05, "Yes", "No")) |>
  knitr::kable(digits = 3)
# check the residuals
qqnorm(residuals(m4)) 
```

**Discussion**
This analysis cyclical variations in sleep quality and perceived stress across the menstrual cycle using mixed-effects models to account for repeated measures within individuals. The findings demonstrate consistent and meaningful changes in both sleep and stress that align with known physiological fluctuations across the menstrual phases.

Sleep quality was highest during the menstrual phase and decreased significantly during the follicular, fertility, and luteal phases. Notably, the fertility (ovulatory) phase showed the largest decline in sleep score, suggesting that the hormonal surge—particularly in estrogen and luteinizing hormone—may disrupt restorative sleep. This pattern aligns with previous research indicating that ovulation can be associated with increased physiological arousal and thermoregulatory changes, which may impair sleep continuity and depth. Despite spending more time in bed during menstruation, participants achieved better sleep quality during this phase, possibly reflecting a compensatory physiological need for rest.

Stress scores followed a complementary pattern: participants experienced the lowest stress (i.e., highest stress scores) during the menstrual phase and the highest stress during the fertility and luteal phases. The increase in stress during the luteal phase is consistent with known premenstrual symptoms such as mood fluctuations, irritability, and heightened emotional sensitivity. The elevated stress during the ovulatory window may reflect endocrine-driven changes that influence emotional reactivity or cognitive load. Together, these results underscore the interconnected nature of hormonal rhythms, stress regulation, and sleep quality across the menstrual cycle.

**Limitation**
The sample size and ethnic distribution may limit generalizability; some ethnic groups were represented by fewer participants, potentially affecting the stability of subgroup trends. In addition, leep and stress scores were derived from self-reported or device-based composite measures, which may not capture the full complexity of physiological processes such as sleep architecture or cortisol variation. 