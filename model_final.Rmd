---
title: "Regression Model"
output: html_document
date: "2025-12-01"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include = FALSE}
library(tidyverse)
library(janitor)
library(broom)
library(lmerTest)
library(lme4)
library(knitr)
library(broom.mixed)
```
## Data Cleaning 
#### Pulling datasets needed and merging into one to prepare for regression analysis 
```{r} 
subject_info_raw = read.csv("clean_data/subject_info.csv")
all_daily_raw = read.csv("clean_data/all_daily_data.csv")

#Adding a category simplifying race that will only be used for regression analysis 
subject_info = subject_info_raw %>%
  mutate(
    race_category = case_when(
      ethnicity %in% c("East Asian", "South Asian", "Southeast Asian") ~ "Asian",
      ethnicity == "White" ~ "White",
      TRUE ~ "Other"),
    race_category = factor(
      race_category, levels = c("Asian", "White", "Other")))

#creating a menstruation binary variable in all_daily
all_daily = all_daily_raw %>%
  mutate(menstruation = factor(if_else(phase == "menstrual", 1, 0),
                          levels = c(0, 1),
                          labels = c("No", "Yes")))

#Creating a merged data frame 
merged_df = all_daily %>%
  left_join(subject_info, by = "id", relationship = "many-to-many")
```
This section leverages the same cleaned data set used in other parts of this analysis. For further simplification with regression, two new variables were created - `race_simplified`, which collapses specific ethnicity categories into broader racial groups (any with a count < 3 was put into other if there was not an applicable category already). Additionally, for simplicity of running the regression focusing on solely menstrual symptoms, a binary variable reporting `menstruation` as "no" (0) or "yes" (1) was created. `merged_df` was created to easily run both demographic and daily data through a regression model. 

## Running basic model to identify significant symptoms and hormones associated with menstruation
#### Identified symptoms/hormones that were significant with mensturation at p<0.05 or less 
```{r}
symptom_model = glmer(
  menstruation ~ fatigue_score + cramps_score + sleepissue_score + exerciselevel_score + appetite_score + bloating_score + moodswing_score + indigestion_score + sorebreasts_score + (1 | id), data = merged_df, family = binomial)

summary(symptom_model)
symptom_model_table = tidy(symptom_model) %>%
  kable()


physiology_model = glmer(
  menstruation ~ estrogen + lh + (1 | id), data = merged_df, family=binomial())

summary(physiology_model)
physiology_model_table = tidy(physiology_model) %>%
  kable()
```
We ran a binomial regression between menstruation and self-reported symptoms. The results of our preliminary regression analysis show that menstruation was positively associated with `fatigue`, `cramps`, and `bloating`. There was a negative association between menstruation and reported `sleep issues` and `sore breasts` as well as measured `estrogen` and `luteinizing hormone (lh)`. 

## Demographic and Lifestyle Factors and Symptoms 
#### Focusing on symptoms that were reported as statistically significant 
```{r}
#Fatigue and Demographic/Lifestyle Factors
fatigue_model = lmer( 
  fatigue_score ~ total_active_min + sleep_score + stress_score + education_abrv + race_category + bmi + age + lh + estrogen + (1 | id), data = merged_df, REML = FALSE)

summary(fatigue_model)

#Cramps and Demographic/Lifestyle Factors
cramps_model = lmer( 
  cramps_score ~ total_active_min + sleep_score + stress_score + education_abrv + race_category + bmi + age + lh + estrogen + (1 | id), data = merged_df, REML = FALSE)

summary(cramps_model)

#Bloating and Demographic/Lifestyle Factors
bloating_model = lmer( 
  bloating_score ~ total_active_min + sleep_score + stress_score + education_abrv + race_category + bmi + age + lh + estrogen + (1 | id), data = merged_df, REML = FALSE)

summary(bloating_model)

#Sleep Issues and Demographic/Lifestyle Factors 
sleepissues_model = lmer( 
  sleepissue_score ~ total_active_min + sleep_score + stress_score + education_abrv + race_category + bmi + age + lh + estrogen + (1 | id), data = merged_df, REML = FALSE)

summary(sleepissues_model)

#Sore Breasts and Demographic/Lifestyle factors 
sorebreasts_model = lmer( 
  sorebreasts_score ~ total_active_min + sleep_score + stress_score + education_abrv + race_category + bmi + age + lh + estrogen + (1 | id), data = merged_df, REML = FALSE)

summary(sorebreasts_model)

```
# Methods 
In this analysis, we took the self-reported symptoms that were significantly association with menstruation at p < 0.05 and ran a regression to determine the association between these symptoms and selected lifestyle and demographic. Specifically, we focused on lifestyle characteristics of `total_active_min` describing the amount of active minutes per participant by day, `sleep_score` which utilized multiple bio metric data endpoints to assess the quality of sleep, and `stress_score` which utilized multiple bio metric data endpoints to assess the degree to which a participant showed symptoms of stress. We also relied on recorded `lh` and `estrogen` levels for a biologic component of this analysis. For demographic characteristics, we selected `education`, `BMI`, `education`, `age`, and `race`. For categorical demographic variables, we used a cleaned version of the data to collapse specific responses into broader categories for simplified analysis when there were <= 3 responses for a single category. 

RESULTS 
We found that self-reported fatigue was positively associated with having the educational attainment of High School (p < 0.001) or Some College (p < 0.001) compared to Bachelor's degree or higher. We found fatigue was negatively associated with being in the "Other" racial category, which was a broad category comprising of hispanic, african, and middle eastern participants. (p < 0.001) There was also a correlation between higher BMI and fatigue (p < 0.05), as well as stress_score and fatigue (p < 0.05). 

We found that bloating was negatively associated with Race being white (p < 0.001) or other (p < 0.001). We also found that bloating was positively associated with educational attainment of high school (p < 0.01) or college (p < 0.001). Furthermore, we found bloating was positively associated with BMI (p < 0.001) and negatively associated with estrogen (p < 0.05). 

We found sleep issues to be positively associated with an educational attainment of high school (p < 0.001) or college (p < 0.001). Furthermore, we found that there was a positive association between higher BMI and reported sleep issues (p < 0.001). We found sleep issues to be negatively associated with being categorized in the "other" race category (p < 0.001). 

We found sore breasts to be only positively associated with older age (p < 0.01). We did not find cramping symptoms to be associated with any biometric or demographic characteristic. 
 

Discussion: 
We found several associations between menstrual symptoms and lifestyle factors, biometric measurements, and demographic characteristics. Interestingly, lifestyle characteristics were consistently among the most significant results in our models. 



Interestingly, some self-reported that might be expected to be linked with related quantitative variables were not positively associated. For example, self-reported fatigue and self-reported sleep issues were not significantly associated with the quantitative variable sleep score that aggregated bio metric data on sleep quality. This could suggest that menstruation creates feelings of fatigue that do not reflect true sleep quality.  

Limitations to this data set as a whole also apply to the significance and generalization of this regression analysis. Namely, the small sample size is a limitation and could be exaggerating the influence of some demographic factors on symptoms. Furthermore, with the population being largely comprised of young, white or Asian participants, these results may not be generalizable to a more diverse population. 