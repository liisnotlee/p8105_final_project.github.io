---
title: "hormone"
output: html_document
date: "2025-11-17"
---
```{r, include=FALSE}
library(tidyverse)
```
```{r, include=FALSE}
hormone=
  read_csv("data/hormones_and_selfreport.csv")
```

##yue's interest: phase, lh, estrogen, moodswing, fatigue

```{r, include=FALSE}
my_int= 
  hormone |>
  select(id,phase, lh, estrogen,fatigue,moodswing)|>
  mutate(
    phase = factor(phase, levels = c("Follicular", "Fertility", "Luteal", "Menstrual")),
    fatigue = factor(fatigue, 
                     levels = c("Low", "Moderate", "High", "Very High")),
    moodswing = factor(moodswing,
                       levels = c("Very Low/Little", "Low", "Moderate", "High","Very High","Not at all"))
  )
phase_order <- c("Menstrual", "Follicular", "Fertility", "Luteal")

```

first, explore relationship between LH and estrogen
```{r, include=FALSE}
my_int_avg= 
  my_int|>
  group_by(phase)|>
  summarise(
    estrogen_mean = mean(estrogen, na.rm = TRUE),
    lh_mean = mean(lh, na.rm = TRUE)
  )|>
  mutate(phase = factor(phase, levels = phase_order))|>
  filter(!is.na(phase))

# Plot the summarized data
ggplot(my_int_avg, aes(x = phase)) +
  geom_line(aes(y = estrogen_mean, color = "Estrogen", group = 1), size = 1) +
  geom_line(aes(y = lh_mean, color = "LH", group = 1), size = 1) +
  geom_point(aes(y = estrogen_mean, color = "Estrogen"), size = 3) +
  geom_point(aes(y = lh_mean, color = "LH"),size= 3) +
  labs(
    title = "Estrogen and LH Levels Across Menstrual Cycle Phases",
    x = "Menstrual Cycle Phase",
    y = "Hormone Level",
    color = "Hormone"
  ) +
  scale_color_manual(values = c("Estrogen" = "red", "LH" = "blue")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
#estrogen surge at fertility(actually it should be called ovulation)
#lh also peak at ovulation

fatigue and moodswing


```{r, include=FALSE}
# Remove NA phases AND NA moodswing/fatigue values
my_int_clean <- my_int |>
  filter(!is.na(phase) & !is.na(moodswing) & !is.na(fatigue))

```


##this two bar graph show the proportion of fatigue and moodswing among four phases, but they are hard to read. 

#so i aim to change the catogorical value (low, moderate, high) to 1,2,3, and so on. i want to sum and avrage. to show a typical cahnge of fatigue and mood in four phases. 

```{r, include=FALSE}
# Convert moodswing and fatigue to numeric intensity scores
my_int_numeric <- my_int_clean %>%
  mutate(
    moodswing_num = case_when(
      moodswing == "Very Low/Little" ~ 1,
      moodswing == "Low" ~ 2,
      moodswing == "Moderate" ~ 3,
      moodswing == "High" ~ 4,
      moodswing == "Very High" ~ 5,
      TRUE ~ NA_real_
    ),
    fatigue_num = case_when(
      fatigue == "Low" ~ 1,
      fatigue == "Moderate" ~ 2,
      fatigue == "High" ~ 3,
      fatigue == "Very High" ~ 4,
      TRUE ~ NA_real_
    )
  )

# Calculate average intensity by phase
symptom_means <- my_int_numeric %>%
  group_by(phase = factor(phase, levels = phase_order)) %>%
  summarise(
    avg_moodswing = mean(moodswing_num, na.rm = TRUE),
    avg_fatigue = mean(fatigue_num, na.rm = TRUE),
    n = n(),
    .groups = 'drop'
  )

symptom_means
```

```{r, include=FALSE}
# Mood swing single line plot
ggplot(symptom_means, aes(x = phase, y = avg_moodswing, group = 1)) +
  geom_line(color = "purple", size = 1.5, alpha = 0.7) +
  geom_point(color = "purple", size = 3) +
  geom_text(aes(label = round(avg_moodswing, 2)), vjust = -1, size = 4, fontface = "bold") +
  labs(
    title = "Average Mood Swing Intensity Across Menstrual Cycle Phases",
    subtitle = "Higher values indicate more severe mood swings (Scale: 1-4)",
    x = "Menstrual Cycle Phase",
    y = "Average Mood Swing Intensity"
  ) +
  ylim(1, 4) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 11),
    plot.title = element_text(face = "bold"),
    panel.grid.major = element_line(color = "grey90")
  )
```
```{r, include=FALSE}
# Fatigue single line plot
ggplot(symptom_means, aes(x = phase, y = avg_fatigue, group = 1)) +
  geom_line(color = "darkorange", size = 1.5, alpha = 0.7) +
  geom_point(color = "darkorange", size = 3) +
  geom_text(aes(label = round(avg_fatigue, 2)), vjust = -1, size = 4, fontface = "bold") +
  labs(
    title = "Average Fatigue Intensity Across Menstrual Cycle Phases",
    subtitle = "Higher values indicate more severe fatigue (Scale: 1-4)",
    x = "Menstrual Cycle Phase",
    y = "Average Fatigue Intensity"
  ) +
  ylim(1, 4) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 11),
    plot.title = element_text(face = "bold"),
    panel.grid.major = element_line(color = "grey90")
  )
```



## for the test, i want to test if moodswing and fatigue have statsitically difference between those four phases. 

```{r, include=FALSE}
kruskal.test(moodswing_num ~ phase, data = my_int_numeric)
kruskal.test(fatigue_num ~ phase, data = my_int_numeric)
```
#cannot reject H0, There is no strong statistical evidence that average instensity of moodswing or fatigue vary across menstrual phases in this dataset. 



#swich approach: longtidual changes


```{r, include=FALSE}
library(lme4)


# Moodswing model
m1 <- lmer(moodswing_num ~ phase + (1 | id), data = my_int_numeric)
summary(m1)

# Fatigue model
m2 <- lmer(fatigue_num ~ phase + (1 | id), data = my_int_numeric)
summary(m2)

```
#Individuals differ substantially in their baseline moodswing levels.
#Again, individuals differ in fatigue baseline, but not as widely as moodswing.

###After adjusting for each individual’s baseline, moodswing intensity significantly increases in the Luteal and Menstrual phases compared with the Follicular phase. Fatigue slightly increases during the Menstrual phase, but the effect is small and borderline significant.

##Linear mixed-effects models were used to evaluate within-person changes in moodswing and fatigue across menstrual phases. The models included a random intercept for each participant to account for individual baseline differences. 
For moodswing, both the Luteal phase (β = 0.144) and the Menstrual phase (β = 0.210) showed significant increases compared with the Follicular phase, indicating that moodswing intensity tends to rise at these points in the cycle. Fertility showed no difference. For fatigue, only the Menstrual phase showed a borderline increase (β = 0.098), while Fertility and Luteal phases did not differ from Follicular. These findings suggest that while group-level averages obscure differences, within individuals, moodswing increases meaningfully in the late luteal and menstrual stages, and fatigue rises slightly during menstruation.



##some updates (Li's advice)
1 scatter plot btw hormone and symtoms. (it's super ugly, no typical trend. everyone has their baseline, #subjective self-report)

2. include more variable such as "flow color" or "flow volume": most of the data is "NOT AT ALL" and na. 
```{r}
sum(hormone$flow_volume == "Not at all", na.rm = TRUE)
sum(hormone$flow_color == "Not at all", na.rm = TRUE)
hormone|>
  summarize(
    na_flow_volume = sum(is.na(flow_volume)),
    na_flow_color  = sum(is.na(flow_color))
  )
nrow(hormone)

```

stress and sleepissue

