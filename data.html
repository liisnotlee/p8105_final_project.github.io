<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Data</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-solid fa-spa"></span>
     
  </a>
</li>
<li>
  <a href="report.html">Report</a>
</li>
<li>
  <a href="data.html">Data</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Lifestyle Factors Analyses
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="hormone.html">Hormone &amp; Symptoms</a>
    </li>
    <li>
      <a href="sleep_stress_khue.html">Sleep &amp; Stress</a>
    </li>
    <li>
      <a href="exercise_hormone.html">Exercise</a>
    </li>
  </ul>
</li>
<li>
  <a href="p8105_final_project_proposal.html">Proposal</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">Meet the Team</a>
</li>
<li>
  <a>
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Data</h1>

</div>


<div id="data-sources" class="section level1">
<h1>Data Sources</h1>
<p>We utilized the inclusive, multimodal, longitudinal, and
de-identified <a
href="https://physionet.org/content/mcphases/1.0.0/">mcPHASES</a>
(menstrual cycle Physiological, Hormonal, and Self-Reported Events and
Symptoms) dataset for menstrual health tracking with wearable
devices.</p>
<p>Data was collected from 42 menstruating young adults in Canada over
two 3-month intervals: Interval 1 (January–April 2022) and Interval 2
(July–October 2024). Participants wore Fitbit Sense smartwatches to
measure physiological signals, and Mira Plus Starter Kits to track their
hormone levels. Participants also self-reported daily symptom
experiences like cramps, sleep quality, and stress levels via a
smartphone diary app.</p>
<p>The original dataset contains 23 structured tables organized by
signal category. For this project, we focused on the lifestyle factors
such as exercise, sleep, and stress, and menstrual cycle symptoms. The
datasets we used are the following:</p>
<ul>
<li>Demographics:
<ul>
<li><code>subject_info.csv</code>: demographic data such as age,
education, and age at menarche, and background survey responses
collected at the start of the study</li>
<li><code>height_and_weight.csv</code>: participant’s baseline height
and weight</li>
</ul></li>
<li>Hormone and Symptoms:
<ul>
<li><code>hormones_and_selfreport.csv</code>：hormone data (LH, E3G,
PdG) from the Mira fertility device and daily self-reported symptom
survey responses (e.g., cramps, mood, menstrual flow) on a 6-level
Likert-type scale from 0 (“Not at all”) to 5 (“Very high”)</li>
</ul></li>
<li>Lifestyle Factors:
<ul>
<li><code>stress_score.csv</code>: daily Stress Management Score from
those who have access to the Stress Management experience</li>
<li><code>sleep.csv</code>: sleep session logs including timestamps,
durations, and quality metrics collected by Fitbit</li>
<li><code>sleep_score.csv</code>: daily sleep score breakdowns provided
by Fitbit, summarizing overall sleep quality based on multiple
contributing factors</li>
</ul></li>
</ul>
<hr />
<p>In total, we have 5 tidy dataframes:</p>
<ol style="list-style-type: decimal">
<li><code>subject_info</code></li>
</ol>
<ul>
<li>Contains demographics and background survey responses data where
each row represents a participant</li>
<li>A total of 62 observations of 18 variables</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li><code>hormone_symptoms</code></li>
</ol>
<ul>
<li>Contains daily hormone and self-reported symptom-related data</li>
<li>A total of 5659 observations of 36 variables</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li><code>sleep_stress_daily</code></li>
</ol>
<ul>
<li>Contains daily sleep and stress related data</li>
<li>A total of 5400 observations of 7 variables</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li><code>exercise_daily</code></li>
</ol>
<ul>
<li>Contains daily exercise related data</li>
<li>A total of 1744 observations of 12 variables</li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li><code>all_daily_data</code></li>
</ol>
<ul>
<li>The multimodal merged version of dataframes 2,3,4, where each row
represents a <strong>daily</strong> data for a person in a specific
study year, including hormone and self-reported symptoms, sleep score,
stress score, daily exercise data.</li>
<li>A total of 5659 observations of 50 variables</li>
</ul>
<p>All dataframes can be linked by participant’s <code>id</code>.</p>
<p>Besides <code>subejct_info</code>, other dataframes can be further
linked by <code>day_in_study</code> and <code>study_interval</code>.</p>
<hr />
</div>
<div id="data-cleaning-process" class="section level1">
<h1>Data Cleaning Process</h1>
<ol style="list-style-type: decimal">
<li>Load necessary libraries</li>
</ol>
<pre class="r"><code>library(tidyverse)
library(patchwork)
library(ggsci)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><p>To ensure a traceable and consistent data cleaning process, we
first read in and saved all original data from csv files to
<code>csv_filename_raw</code> dataframes. Then start tidying process to
saved cleaned version of data with interested variables in separate
dataframes, so we always have access back to the original data.</p></li>
<li><p>Created a reusable function for data completenss sanity
check.</p></li>
</ol>
<pre class="r"><code>sanity_check &lt;- function(df){
  df |&gt; 
  summarise(across(everything(), ~ sum(is.na(.))))  |&gt; 
  pivot_longer(
    cols = everything(),
    names_to = &quot;Column_Name&quot;,
    values_to = &quot;NA_Count&quot;
  ) |&gt; 
  mutate(
    Total_Rows = nrow(df),
    NA_Percentage = paste0(round((NA_Count / Total_Rows) * 100, 2), &quot;%&quot;)
  ) |&gt; 
  knitr::kable()
}</code></pre>
<div id="subject_info---subject-relevant-data" class="section level2">
<h2><code>subject_info</code> - Subject-Relevant Data</h2>
<p><em>Overview:</em></p>
<p>The <code>subject_info</code> dataframe contains participants
demographics data from <code>subject_info.csv</code> and
<code>height_and_weight.csv</code>, as well as participants study
enrollment year (this piece of information is from
<code>hormones_and_selfreport.csv</code>).</p>
<p>It contains a total of 62 observations of 18 variables. Some key
variables are the following:</p>
<ul>
<li><code>id</code>: participant’s unique identifier</li>
<li>Age relevant variables: <code>birth_year</code> and
<code>age_of_first_menarche</code></li>
<li>Height and weight related variables: <code>avg_height</code>,
<code>avg_weight</code>, <code>bmi</code></li>
<li>Study enrollment related information: <code>study</code> (flag of
which study the participant enrolled in, <code>1</code>=2022,
<code>2</code>=2024, <code>3</code>=both), <code>year</code> (the year
of study)</li>
<li>Categorical/Factor variables like <code>ethnicity</code>,
<code>education</code>,
<code>self_report_menstrual_health_literacy</code>, etc.</li>
</ul>
<p><em>Steps:</em></p>
<ol style="list-style-type: decimal">
<li>Cleaned up data from <code>height_and_weight.csv</code> into a
dataframe called <code>ht_wt</code> which contains 42 observations of 7
variables.
<ol style="list-style-type: decimal">
<li>Some participants were enrolled in both 2022 and 2024, so they had
baseline records of height and weight for both years (like
<code>height_2022</code> and <code>height_2024</code>); hence, we took
the averages and added two columns as <code>avg_height</code> and
<code>avg_weight</code>.</li>
<li>Checked data completeness.</li>
</ol>
<ul>
<li><strong>Noted a lot of missing values for baseline height and
weight, which might cause incomplete/biased data representation for
participant characteristics summary.</strong></li>
<li><strong>Noted that only 24 participants have at least one record of
weight and height.</strong></li>
</ul></li>
</ol>
<pre class="r"><code>ht_wt = read_csv(&quot;data/height_and_weight.csv&quot;)|&gt; 
  janitor::clean_names() |&gt; 
  # calculate mean height/weight
  rowwise() |&gt;
  mutate(
    avg_height = mean(c(height_2022, height_2024), na.rm = TRUE),
    avg_weight = mean(c(weight_2022, weight_2024), na.rm = TRUE)
  ) |&gt;
  ungroup()</code></pre>
<pre class="r"><code># at least contain one ht and wt
ht_wt |&gt;
  count(!is.na(avg_height) &amp; !is.na(avg_weight))|&gt; 
  knitr::kable()

ht_wt |&gt;
  summarise(
    missing_ht = sum(is.na(avg_height)),
    missing_wt = sum(is.na(avg_weight)),
    missing_both = sum(is.na(avg_weight) &amp; is.na(avg_height))
  ) |&gt; 
  knitr::kable()</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Extracted participants study enrollment information from
<code>hormones_and_selfreport.csv</code> and created a
<code>study_flag</code> dataframe to represent the study year(s)
participants were enrolled in (<code>0</code>=No, <code>1</code>=Yes).
The <code>study_flag</code> dataframe only contains 3 variables:
<code>id</code>, <code>study_2022</code> and
<code>study_2024</code>.</li>
</ol>
<pre class="r"><code># import csv file
hormones_and_selfreport = read_csv(&quot;data/hormones_and_selfreport.csv&quot;) |&gt; 
  janitor::clean_names() 
# extract study_flag
study_flag &lt;- hormones_and_selfreport  |&gt; 
  distinct(id, study_interval) |&gt; 
  mutate(flag = 1,
         study_interval = paste0(&quot;study_&quot;, study_interval)) |&gt; 
  pivot_wider(
    names_from = study_interval,
    values_from = flag,
    values_fill = 0  
  )</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Merged <code>ht_wt</code> and <code>study_flag</code> with
<code>subject_info</code> from <code>subject-info.csv</code> by
participant’s <code>id</code>.
<ol style="list-style-type: decimal">
<li>Used <code>pivot_long()</code> for height, weight and study year
variables (<code>1</code>=2022 only, <code>2</code>=2024 only,
<code>3</code>=both 2022 and 2024). <strong>Noted that participcants in
2024 were a subset of participants in 2022. In other words, there was no
new participants in study 2024.</strong> Because we used
<code>pivot_long</code>, now if a participant was enrolled in both
years, she will have 2 rows representing each year.</li>
<li>Ensured all variables are in the correct type (e.g. numeric for age,
height, weight, etc.).</li>
<li>Calculated age based on enrollment study year.</li>
<li>Calculated BMI for participants with both weight and height
records.</li>
<li>Factored categorical variables.</li>
<li>Grouped low-frequency or rare categories within the
<code>education</code> and <code>gender</code> variables into
meaningful, broader levels (e.g., ‘PhD’ and ‘Master’ were
combined).</li>
<li>Removed redundant columns and rearranged the column with
<code>id</code> and <code>study_interval</code> at beginning for
improved readability.</li>
</ol></li>
</ol>
<pre class="r"><code># read in subject-info.csv
subject_info_raw = read_csv(&quot;data/subject-info.csv&quot;) |&gt; 
  janitor::clean_names()

subject_info &lt;- subject_info_raw  |&gt; 
  # merging
  left_join(ht_wt, by = &quot;id&quot;) |&gt; 
  left_join(study_flag, by = &quot;id&quot;) |&gt;
  # add a study_flag
  mutate(
    study = case_when(
      study_2022 == 1 &amp; study_2024 == 1 ~ 3L,  # both 2022 &amp; 2024
      study_2022 == 1 &amp; study_2024 == 0 ~ 1L,  
      study_2024 == 1 &amp; study_2022 == 0 ~ 2L,  
      TRUE ~ NA_integer_
    )
  ) |&gt; 
  # pivot_long for wt &amp; ht
  pivot_longer(
    cols = c(weight_2022, weight_2024, height_2022, height_2024),
    names_to  = c(&quot;.value&quot;, &quot;year&quot;), 
    names_sep = &quot;_&quot;                 
  ) |&gt; 
  rename(
    weight_yr = weight,
    height_yr = height
  ) |&gt; 
  # keep only the relevant study year
  filter(
    (study == 1 &amp; year == 2022) |
    (study == 2 &amp; year == 2024) |
    (study == 3)
  ) |&gt; 
  # calculate age
  mutate(
    year = as.numeric(year),
    birth_year = as.numeric(birth_year),
    age = year - birth_year
  ) |&gt; 
  # get a mean age for each id
  group_by(id) |&gt; 
  mutate(
    mean_age = mean(age, na.rm = TRUE)
  ) |&gt; 
  ungroup() |&gt; 
  # get BMI
  mutate(
    bmi = weight_yr / ( (height_yr / 100)^2 )
  )|&gt;
  # convert NaN to NA
  mutate(
    across(c(avg_weight, avg_height), 
           ~ if_else(is.nan(.), NA_real_, .))
  ) |&gt; 
  #this factors variables and also creates &quot;gender abrv&quot; and &quot;education abrv&quot;, which are simplified versions of these variables for cleaner tables and figures 
  mutate(
    education = str_trim(education),
    education_abrv = case_when(
      education == &quot;High school degree or equivalent (e.g. GED)&quot; ~ &quot;High School&quot;,
      education == &quot;Some university/ post-secondary, no degree&quot; ~ &quot;Some College&quot;,
      education == &quot;Bachelor&#39;s degree (e.g. BA, BS)&quot; ~ &quot;Bachelors&quot;,
      education %in% c(&quot;Master&#39;s degree (e.g. MA, MS, MEd)&quot;, &quot;Doctorate or professional degree&quot;) ~ &quot;Graduate Degree or Higher&quot;,
      TRUE ~ &quot;Other&quot;),
    education_abrv = factor(
      education_abrv,
      levels = c(&quot;High School&quot;, &quot;Some College&quot;, &quot;Bachelors&quot;, &quot;Graduate Degree or Higher&quot;, &quot;Other&quot;),
      ordered = TRUE),
     self_report_menstrual_health_literacy = factor(
      self_report_menstrual_health_literacy,
      levels = c(&quot;Non-existant&quot;, &quot;Low&quot;, &quot;Medium&quot;, &quot;High&quot;),
      ordered = TRUE),
    gender_abrv = case_when(
      gender %in% c(&quot;Gender Fluid&quot;, &quot;Non-binary&quot;) ~ &quot;Gender Fluid or Non-binary&quot;, 
      gender %in% c(&quot;Prefer not to say&quot;, &quot;Other&quot;) ~ &quot;Prefer not to say or Other&quot;, 
      gender == &quot;Woman&quot; ~ &quot;Woman&quot;),
      gender_abrv = factor(gender_abrv, levels = c(&quot;Woman&quot;, &quot;Gender Fluid or Non-binary&quot;, &quot;Prefer not to say or Other&quot;)), 
      sexually_active = factor(sexually_active, levels = c(&quot;Yes&quot;, &quot;No&quot;, &quot;Prefer not to say&quot;))) |&gt; 
  # only need 1 study_interval flag to indicate the study year
  mutate(study_interval = year) |&gt; 
  select(-study_2022, -study_2024, -year, -study) |&gt; 
  # rearrange the column order
  select(
    id,     
    study_interval,     
    everything()
  )</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Check data completeness.</li>
</ol>
<p>As mentioned before, <strong>near half of height and weight related
data were missing.</strong> Other basic demographics data were compelete
besides a 6.45% of missingness in
<code>self_report_menstrual_health_literacy</code>.</p>
<pre class="r"><code>sanity_check(subject_info)</code></pre>
<table>
<colgroup>
<col width="52%" />
<col width="12%" />
<col width="15%" />
<col width="19%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Column_Name</th>
<th align="right">NA_Count</th>
<th align="right">Total_Rows</th>
<th align="left">NA_Percentage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">id</td>
<td align="right">0</td>
<td align="right">62</td>
<td align="left">0%</td>
</tr>
<tr class="even">
<td align="left">study_interval</td>
<td align="right">0</td>
<td align="right">62</td>
<td align="left">0%</td>
</tr>
<tr class="odd">
<td align="left">birth_year</td>
<td align="right">0</td>
<td align="right">62</td>
<td align="left">0%</td>
</tr>
<tr class="even">
<td align="left">gender</td>
<td align="right">0</td>
<td align="right">62</td>
<td align="left">0%</td>
</tr>
<tr class="odd">
<td align="left">ethnicity</td>
<td align="right">0</td>
<td align="right">62</td>
<td align="left">0%</td>
</tr>
<tr class="even">
<td align="left">education</td>
<td align="right">0</td>
<td align="right">62</td>
<td align="left">0%</td>
</tr>
<tr class="odd">
<td align="left">sexually_active</td>
<td align="right">0</td>
<td align="right">62</td>
<td align="left">0%</td>
</tr>
<tr class="even">
<td align="left">self_report_menstrual_health_literacy</td>
<td align="right">4</td>
<td align="right">62</td>
<td align="left">6.45%</td>
</tr>
<tr class="odd">
<td align="left">age_of_first_menarche</td>
<td align="right">0</td>
<td align="right">62</td>
<td align="left">0%</td>
</tr>
<tr class="even">
<td align="left">avg_height</td>
<td align="right">22</td>
<td align="right">62</td>
<td align="left">35.48%</td>
</tr>
<tr class="odd">
<td align="left">avg_weight</td>
<td align="right">14</td>
<td align="right">62</td>
<td align="left">22.58%</td>
</tr>
<tr class="even">
<td align="left">weight_yr</td>
<td align="right">27</td>
<td align="right">62</td>
<td align="left">43.55%</td>
</tr>
<tr class="odd">
<td align="left">height_yr</td>
<td align="right">33</td>
<td align="right">62</td>
<td align="left">53.23%</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">0</td>
<td align="right">62</td>
<td align="left">0%</td>
</tr>
<tr class="odd">
<td align="left">mean_age</td>
<td align="right">0</td>
<td align="right">62</td>
<td align="left">0%</td>
</tr>
<tr class="even">
<td align="left">bmi</td>
<td align="right">36</td>
<td align="right">62</td>
<td align="left">58.06%</td>
</tr>
<tr class="odd">
<td align="left">education_abrv</td>
<td align="right">0</td>
<td align="right">62</td>
<td align="left">0%</td>
</tr>
<tr class="even">
<td align="left">gender_abrv</td>
<td align="right">0</td>
<td align="right">62</td>
<td align="left">0%</td>
</tr>
</tbody>
</table>
</div>
<div
id="hormone_symptoms---daily-hormone-and-self-reported-symptom-related-data"
class="section level2">
<h2><code>hormone_symptoms</code> - Daily Hormone and Self-Reported
Symptom-Related Data</h2>
<p><em>Overview:</em></p>
<p>The <code>hormone_symptoms</code> dataframe contains participants’
daily hormone data (LH, E3G, PdG) and self-reported symptom-related data
(e.g., cramps, mood, menstrual flow) on a 6-level Likert-type scale from
0 (“Not at all”) to 5 (“Very high”), from
<code>hormones_and_selfreport.csv</code>.</p>
<p>It contains a total of 5659 observations of 36 variables. Some key
variables are the following:</p>
<ul>
<li><code>id</code>: participant’s unique identifier</li>
<li><code>study_interval</code>: the year of study that participant
enrolled in 2022 or 2024)</li>
<li><code>day_in_study</code>: normalized day index starting from day 1
of each participant’s study interval</li>
<li><code>phase</code>: factor menstrual cycle phase label (follicular,
ovulation, luteal, or fertility)</li>
<li>Hormone data: <code>lh</code> (luteinizing hormone (mIU/mL) level,
<code>estrogen</code> (estrone-3-glucuronide level (ng/mL)), and
<code>pdg</code> (pregnanediol glucuronide (mcg/mL))</li>
<li>Factor flow data: <code>flow_volume</code> on a Likert scale (Lowest
= “Not at all” to highest = “Very Heavy”), and <code>flow_color</code>
(categorical indicator of menstrual flow or discharge color)</li>
<li>Factor symptoms severity data on Likert scale, such as
<code>cramps</code>, <code>fatigue</code>, and
<code>moodswing</code>.</li>
<li>Numeric symptoms severity data converted from factor symptoms
severity data, such as <code>cramps_score</code>,
<code>fatigue_score</code>, and <code>moodswing_score</code>.</li>
</ul>
<p><em>Steps:</em></p>
<ol style="list-style-type: decimal">
<li>Standardized all character variable values to lowercase.</li>
<li>Converted all categorical data (Likert responses) to ordered factor
variables according to predefined level structure
(<code>likert_level_factor</code> or
<code>likert_levels_no_verylowlittle</code>).</li>
<li>Created numeric severity scores columns.
<ol style="list-style-type: decimal">
<li>Defined numerical mapping to convert the categorical factor levels
into quantitative scores (<code>likert_6_levels</code>), making the
variables suitable for mathematical modeling.</li>
<li>Created a new set of columns, suffixed with <code>_score</code>, by
using <code>recode()</code> the categorical variables (from appetite to
bloating) based on the mapping schema.</li>
<li>Created special numeric conversion for flow data (flow_color and
flow_volume) as they were not on the same Likert scale, by using
<code>case_when()</code>.</li>
</ol></li>
</ol>
<pre class="r"><code># read in raw csv file
hormone_symptoms_raw &lt;- 
  read_csv(&quot;data/hormones_and_selfreport.csv&quot;) |&gt; 
  janitor::clean_names() 

# factor string values
likert_level_factor = c(&quot;not at all&quot;, &quot;very low/little&quot;, &quot;low&quot;, &quot;moderate&quot;, &quot;high&quot;, &quot;very high&quot;)
likert_levels_no_verylowlittle = c(&quot;not at all&quot;, &quot;very low&quot;, &quot;low&quot;, &quot;moderate&quot;, &quot;high&quot;, &quot;very high&quot;)
# likert_scale for numeric score conversion
likert_6_levels = c(&quot;not at all&quot; = 0, &quot;very low/little&quot; = 1, &quot;very low&quot; = 1, &quot;low&quot; = 2, &quot;moderate&quot; = 3, &quot;high&quot; = 4, &quot;very high&quot; = 5)


hormone_symptoms &lt;- hormone_symptoms_raw |&gt; 
  # convert all to lower case string for standardization
  mutate(across(flow_volume:bloating, 
                ~ ifelse(!is.na(.) &amp; !grepl(&quot;^\\d+$&quot;, .), tolower(.), .))) |&gt; 
  mutate(across(c(phase), ~ ifelse(!is.na(.) &amp; !grepl(&quot;^\\d+$&quot;, .), tolower(.), .))) |&gt; 
  # factor variables
  mutate(
    phase = factor(phase, levels = c(&quot;menstrual&quot;, &quot;follicular&quot;, &quot;fertility&quot;, &quot;luteal&quot;)),
    flow_volume = factor(flow_volume, 
                         levels = c(&quot;not at all&quot;, &quot;spotting / very light&quot;,&quot;light&quot;,&quot;moderate&quot;, &quot;somewhat heavy&quot;,&quot;heavy&quot;, &quot;very heavy&quot;)),
    flow_color = factor(flow_color,
                        levels = c(&quot;not at all&quot;, &quot;pink&quot;,&quot;bright red&quot;, &quot;dark brown / dark red&quot;, &quot;grey&quot;, &quot;black&quot;,&quot;other&quot;)),
  ) |&gt; 
  # factor character values
  mutate(
    across(
    .cols = c(sleepissue, headaches, stress, cramps, foodcravings, indigestion, bloating, moodswing, sorebreasts, fatigue),  
    .fns = ~ factor(., levels = likert_level_factor),  
    .names = &quot;{.col}&quot;  
  )
  ) |&gt; 
  mutate(across(
    .cols = c(appetite, exerciselevel),
    .fns = ~ factor(., levels = likert_levels_no_verylowlittle), 
    .names = &quot;{.col}&quot;  
  )) |&gt; 
  # convert categorical variable values to numeric intensity scores
  mutate(across(
    .cols = appetite:bloating,
    .fns = ~ recode(., !!!likert_6_levels),
    .names = &quot;{.col}_score&quot;
  )) |&gt; 
  # special conversion for flow
  mutate(
    flow_volume_score = case_when(
      flow_volume == &quot;not at all&quot; ~ 0,
      flow_volume == &quot;spotting / very light&quot; ~ 1,
      flow_volume == &quot;light&quot; ~ 2,
      flow_volume == &quot;moderate&quot; ~ 3,
      flow_volume == &quot;somewhat heavy&quot; ~ 4,
      flow_volume == &quot;heavy&quot; ~ 5,
      flow_volume == &quot;very heavy&quot; ~ 6,
      TRUE ~ NA_real_
    ),
    flow_color_score = case_when(
      flow_color == &quot;not at all&quot; ~ 0,
      flow_color == &quot;pink&quot; ~ 1,
      flow_color == &quot;bright red&quot; ~ 2,
      flow_color == &quot;dark brown / dark red&quot; ~ 3,
      flow_color == &quot;grey&quot; ~ 4,
      flow_color == &quot;black&quot; ~ 5,
      flow_color == &quot;other&quot; ~ 6,
      TRUE ~ NA_real_
    )
  )</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Checked data quality and completeness.</li>
</ol>
<ul>
<li><strong>Noted a lot of missing (<code>NA</code>) values (nearly
half) for symptoms data, which is very common in patient-generated
self-reported data.</strong></li>
<li><strong>Noted over half of <code>pdg</code> data were missing
(<code>NA</code>), indicating poor data completeness. Hence, we
considered to exclude it and proceeded with <code>lg</code> and
<code>estrogen</code> due to their superior data
availability.</strong></li>
</ul>
<pre class="r"><code>sanity_check(hormone_symptoms)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Column_Name</th>
<th align="right">NA_Count</th>
<th align="right">Total_Rows</th>
<th align="left">NA_Percentage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">id</td>
<td align="right">0</td>
<td align="right">5659</td>
<td align="left">0%</td>
</tr>
<tr class="even">
<td align="left">study_interval</td>
<td align="right">0</td>
<td align="right">5659</td>
<td align="left">0%</td>
</tr>
<tr class="odd">
<td align="left">is_weekend</td>
<td align="right">0</td>
<td align="right">5659</td>
<td align="left">0%</td>
</tr>
<tr class="even">
<td align="left">day_in_study</td>
<td align="right">0</td>
<td align="right">5659</td>
<td align="left">0%</td>
</tr>
<tr class="odd">
<td align="left">phase</td>
<td align="right">1</td>
<td align="right">5659</td>
<td align="left">0.02%</td>
</tr>
<tr class="even">
<td align="left">lh</td>
<td align="right">320</td>
<td align="right">5659</td>
<td align="left">5.65%</td>
</tr>
<tr class="odd">
<td align="left">estrogen</td>
<td align="right">321</td>
<td align="right">5659</td>
<td align="left">5.67%</td>
</tr>
<tr class="even">
<td align="left">pdg</td>
<td align="right">3795</td>
<td align="right">5659</td>
<td align="left">67.06%</td>
</tr>
<tr class="odd">
<td align="left">flow_volume</td>
<td align="right">2567</td>
<td align="right">5659</td>
<td align="left">45.36%</td>
</tr>
<tr class="even">
<td align="left">flow_color</td>
<td align="right">2617</td>
<td align="right">5659</td>
<td align="left">46.24%</td>
</tr>
<tr class="odd">
<td align="left">appetite</td>
<td align="right">2329</td>
<td align="right">5659</td>
<td align="left">41.16%</td>
</tr>
<tr class="even">
<td align="left">exerciselevel</td>
<td align="right">2329</td>
<td align="right">5659</td>
<td align="left">41.16%</td>
</tr>
<tr class="odd">
<td align="left">headaches</td>
<td align="right">2339</td>
<td align="right">5659</td>
<td align="left">41.33%</td>
</tr>
<tr class="even">
<td align="left">cramps</td>
<td align="right">2332</td>
<td align="right">5659</td>
<td align="left">41.21%</td>
</tr>
<tr class="odd">
<td align="left">sorebreasts</td>
<td align="right">2332</td>
<td align="right">5659</td>
<td align="left">41.21%</td>
</tr>
<tr class="even">
<td align="left">fatigue</td>
<td align="right">2328</td>
<td align="right">5659</td>
<td align="left">41.14%</td>
</tr>
<tr class="odd">
<td align="left">sleepissue</td>
<td align="right">2330</td>
<td align="right">5659</td>
<td align="left">41.17%</td>
</tr>
<tr class="even">
<td align="left">moodswing</td>
<td align="right">2339</td>
<td align="right">5659</td>
<td align="left">41.33%</td>
</tr>
<tr class="odd">
<td align="left">stress</td>
<td align="right">2339</td>
<td align="right">5659</td>
<td align="left">41.33%</td>
</tr>
<tr class="even">
<td align="left">foodcravings</td>
<td align="right">2332</td>
<td align="right">5659</td>
<td align="left">41.21%</td>
</tr>
<tr class="odd">
<td align="left">indigestion</td>
<td align="right">2334</td>
<td align="right">5659</td>
<td align="left">41.24%</td>
</tr>
<tr class="even">
<td align="left">bloating</td>
<td align="right">2331</td>
<td align="right">5659</td>
<td align="left">41.19%</td>
</tr>
<tr class="odd">
<td align="left">appetite_score</td>
<td align="right">2329</td>
<td align="right">5659</td>
<td align="left">41.16%</td>
</tr>
<tr class="even">
<td align="left">exerciselevel_score</td>
<td align="right">2329</td>
<td align="right">5659</td>
<td align="left">41.16%</td>
</tr>
<tr class="odd">
<td align="left">headaches_score</td>
<td align="right">2339</td>
<td align="right">5659</td>
<td align="left">41.33%</td>
</tr>
<tr class="even">
<td align="left">cramps_score</td>
<td align="right">2332</td>
<td align="right">5659</td>
<td align="left">41.21%</td>
</tr>
<tr class="odd">
<td align="left">sorebreasts_score</td>
<td align="right">2332</td>
<td align="right">5659</td>
<td align="left">41.21%</td>
</tr>
<tr class="even">
<td align="left">fatigue_score</td>
<td align="right">2328</td>
<td align="right">5659</td>
<td align="left">41.14%</td>
</tr>
<tr class="odd">
<td align="left">sleepissue_score</td>
<td align="right">2330</td>
<td align="right">5659</td>
<td align="left">41.17%</td>
</tr>
<tr class="even">
<td align="left">moodswing_score</td>
<td align="right">2339</td>
<td align="right">5659</td>
<td align="left">41.33%</td>
</tr>
<tr class="odd">
<td align="left">stress_score</td>
<td align="right">2339</td>
<td align="right">5659</td>
<td align="left">41.33%</td>
</tr>
<tr class="even">
<td align="left">foodcravings_score</td>
<td align="right">2332</td>
<td align="right">5659</td>
<td align="left">41.21%</td>
</tr>
<tr class="odd">
<td align="left">indigestion_score</td>
<td align="right">2334</td>
<td align="right">5659</td>
<td align="left">41.24%</td>
</tr>
<tr class="even">
<td align="left">bloating_score</td>
<td align="right">2331</td>
<td align="right">5659</td>
<td align="left">41.19%</td>
</tr>
<tr class="odd">
<td align="left">flow_volume_score</td>
<td align="right">2567</td>
<td align="right">5659</td>
<td align="left">45.36%</td>
</tr>
<tr class="even">
<td align="left">flow_color_score</td>
<td align="right">2617</td>
<td align="right">5659</td>
<td align="left">46.24%</td>
</tr>
</tbody>
</table>
</div>
<div id="sleep_stress_daily---daily-sleep-and-stress-related-data"
class="section level2">
<h2><code>sleep_stress_daily</code> - Daily Sleep and Stress Related
Data</h2>
<p><em>Overview:</em> The <code>sleep_stress_daily</code> dataframe
contains participants’ daily sleep and stress data from 3 csv files
(<code>sleep.csv</code>, <code>sleep_score.csv</code> and
<code>stress_score.csv</code>).</p>
<p>It contains a total of 5400 observations of 7 variables. Some key
variables are the following:</p>
<ul>
<li><code>id</code>: participant’s unique identifier</li>
<li><code>study_interval</code>: the year of study that participant
enrolled in 2022 or 2024)</li>
<li><code>day_in_study</code>: normalized day index starting from day 1
of each participant’s study interval</li>
<li>Sleep session logs data like <code>timeinbed_mean</code> (average
minutes in bed) and <code>deep_sleep_in_minutes</code> (minutes spent in
deep sleep)</li>
<li><code>sleep_score</code>: overall sleep score out of 100, the higher
the better</li>
<li><code>stress_score</code>: overall sleep score out of 100, the
higher the better</li>
</ul>
<p><em>Steps:</em></p>
<ol style="list-style-type: decimal">
<li>Combined data from <code>sleep_score.csv</code> and
<code>stress_score.csv</code> into <code>sleep_stress_score</code>
dataframe.
<ol style="list-style-type: decimal">
<li>Cleaned <code>sleep_score.csv</code>:
<ol style="list-style-type: decimal">
<li>Chose to include only the essential identifiers and interested
variables using <code>select()</code>.</li>
<li>Renamed the <code>overall_score</code> column to
<code>sleep_score</code> for descriptive standardization.</li>
<li>Removed <code>sleep_score</code> duplicates; only the row with the
maximum <code>sleep_score</code> was retained to ensure each day has a
unique sleep score.</li>
</ol></li>
<li>Cleaned <code>stress_score.csv</code>:
<ol style="list-style-type: decimal">
<li>Filtered out invalid score data by excluding records where the
stress calculation failed.</li>
<li>Chose to include only the essential identifiers and score
columns.</li>
<li>Removed duplicate entries using the <code>distinct()</code>,
ensuring that each day has a unique stress score.</li>
</ol></li>
<li>Merged sleep and stress scores using <code>full_join()</code> to
keep all data points.</li>
<li>Checked data quality and completeness of sleep score and stress
score.
<ol style="list-style-type: decimal">
<li>No duplicates found for each unique combination of <code>id</code>,
<code>study_interval</code>, and <code>day_in_study</code>.</li>
<li><strong>Noted nearly 1/3 of <code>stress_score</code> were missing
(<code>NA</code>).</strong></li>
<li><strong>A total of 3638 observations/daily records had both
<code>sleep_score</code> and <code>stress_score</code></strong></li>
</ol></li>
</ol></li>
</ol>
<pre class="r"><code># load raw data from csv files
sleep_score_raw &lt;- read_csv(&quot;data/sleep_score.csv&quot;) |&gt;
  janitor::clean_names()
sleep_raw       &lt;- read_csv(&quot;data/sleep.csv&quot;) |&gt;
  janitor::clean_names()
stress_score_raw &lt;- read_csv(&quot;data/stress_score.csv&quot;) |&gt;
  janitor::clean_names()

# combine the sleep and stress score
sleep_score &lt;- sleep_score_raw |&gt;
  select(id,study_interval, day_in_study, overall_score, deep_sleep_in_minutes) |&gt; 
  mutate(sleep_score = overall_score) |&gt; 
  select(-overall_score) |&gt; 
  # remove duplicates by keeping the maximum score
  group_by(id, study_interval, day_in_study) |&gt; 
  slice_max(order_by = sleep_score, n = 1, with_ties = FALSE) |&gt; 
  ungroup()

stress_score &lt;- stress_score_raw |&gt;
  filter(calculation_failed == &quot;FALSE&quot;)|&gt;
  select(id, study_interval, day_in_study, stress_score)|&gt;
  distinct(id, study_interval, day_in_study, .keep_all = TRUE)


sleep_stress_score &lt;- full_join(sleep_score, stress_score, by=c(&quot;id&quot;, &quot;study_interval&quot;, &quot;day_in_study&quot;))</code></pre>
<pre class="r"><code># check duplicates &gt;&gt; no duplicates nice
sleep_stress_score |&gt; 
  group_by(id, study_interval, day_in_study) |&gt; 
  filter(n() &gt; 1)</code></pre>
<pre class="r"><code>sanity_check(sleep_score)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Column_Name</th>
<th align="right">NA_Count</th>
<th align="right">Total_Rows</th>
<th align="left">NA_Percentage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">id</td>
<td align="right">0</td>
<td align="right">5078</td>
<td align="left">0%</td>
</tr>
<tr class="even">
<td align="left">study_interval</td>
<td align="right">0</td>
<td align="right">5078</td>
<td align="left">0%</td>
</tr>
<tr class="odd">
<td align="left">day_in_study</td>
<td align="right">0</td>
<td align="right">5078</td>
<td align="left">0%</td>
</tr>
<tr class="even">
<td align="left">deep_sleep_in_minutes</td>
<td align="right">2</td>
<td align="right">5078</td>
<td align="left">0.04%</td>
</tr>
<tr class="odd">
<td align="left">sleep_score</td>
<td align="right">0</td>
<td align="right">5078</td>
<td align="left">0%</td>
</tr>
</tbody>
</table>
<pre class="r"><code># check how many days have both scores
sleep_stress_score %&gt;%
  filter(!is.na(stress_score) &amp; !is.na(sleep_score)) |&gt; nrow()</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Cleaned data from <code>sleep.csv</code> with
<code>sleep_stress_score</code> dataframe.
<ol style="list-style-type: decimal">
<li>Chose to include only the essential identifiers and interested
variables using <code>select()</code>.</li>
<li>Filtered to retain only the main sleep session, excluding secondary
sleep episodes (like naps).</li>
<li>Noted duplicated <code>timeinbed</code> for study 2024; we suspected
it as data entry issues. We decided to remove duplicate records by
replacing multiple <code>timeinbed</code> values with their mean. As we
checked the density distribution of the <code>mean_timeinbed</code> for
duplicates, its mode is close to the average timeinbed in 2022 (401.5758
minutes).</li>
<li>Checked data completeness and ensured no duplicates. <strong>No
missing values in <code>sleep</code> dataframe.</strong></li>
</ol></li>
</ol>
<pre class="r"><code># working on sleep data
sleep &lt;- sleep_raw|&gt;
  select(id,study_interval, sleep_end_day_in_study, timeinbed, mainsleep) |&gt;
  # changed to sleep_end_day
  mutate(day_in_study = sleep_end_day_in_study) |&gt;
  select(-sleep_end_day_in_study) |&gt; 
  # only keep main sleep = TRUE as mainsleep: boolean indicating whether this is the main sleep session of the day
  filter(
    mainsleep == TRUE
  ) |&gt; 
# check duplicates &gt;&gt; all duplicates from 2024
  group_by(id, study_interval, day_in_study) |&gt;
  summarise(
    timeinbed_mean = mean(timeinbed, na.rm = TRUE),
    mainsleep = first(mainsleep),
    .groups = &quot;drop&quot; 
  ) |&gt;
  ungroup() |&gt; 
  # no need flag
  select(-mainsleep)

# density distribution of mean timeinbed in 2024
sleep_raw |&gt;
  select(id,study_interval, sleep_end_day_in_study, timeinbed, mainsleep) |&gt;
  # changed to sleep_end_day
  mutate(day_in_study = sleep_end_day_in_study) |&gt;
  select(-sleep_end_day_in_study) |&gt; 
  filter(
    mainsleep == TRUE
  ) |&gt; 
  group_by(id, study_interval, day_in_study) |&gt; 
  summarise(
    mean_timeinbed = mean(timeinbed, na.rm = TRUE),
    .groups = &quot;drop&quot;
  ) |&gt; 
  ggplot(aes(x = mean_timeinbed)) +
  geom_density(fill = &quot;skyblue&quot;, alpha = 0.5) +  # 填充颜色为淡蓝色，透明度为0.5
  labs(title = &quot;Density Distribution of Mean Time in Bed&quot;, 
       x = &quot;Mean Time in Bed (minutes)&quot;, 
       y = &quot;Density&quot;)</code></pre>
<p><img src="data_files/figure-html/load-sleep-data-1.png" width="672" /></p>
<pre class="r"><code>sanity_check(sleep)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Column_Name</th>
<th align="right">NA_Count</th>
<th align="right">Total_Rows</th>
<th align="left">NA_Percentage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">id</td>
<td align="right">0</td>
<td align="right">5400</td>
<td align="left">0%</td>
</tr>
<tr class="even">
<td align="left">study_interval</td>
<td align="right">0</td>
<td align="right">5400</td>
<td align="left">0%</td>
</tr>
<tr class="odd">
<td align="left">day_in_study</td>
<td align="right">0</td>
<td align="right">5400</td>
<td align="left">0%</td>
</tr>
<tr class="even">
<td align="left">timeinbed_mean</td>
<td align="right">0</td>
<td align="right">5400</td>
<td align="left">0%</td>
</tr>
</tbody>
</table>
<pre class="r"><code># mean timeinbed in 2022
sleep_raw |&gt; 
  filter(study_interval == 2022) |&gt; 
  pull(timeinbed) |&gt; 
  mean(na.rm = TRUE)


# check duplicates in sleep &gt; no duplicates
sleep |&gt; count(id, study_interval, day_in_study) |&gt;
  filter(n &gt; 1)</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Combined <code>sleep</code> and <code>sleep_stress_score</code>
dataframes by <code>full_join()</code> and performed final data
completeness check.</li>
</ol>
<pre class="r"><code># MERGE
sleep_stress_daily &lt;- full_join(sleep, sleep_stress_score, by=c(&quot;id&quot;, &quot;study_interval&quot;, &quot;day_in_study&quot;))

sanity_check(sleep_stress_daily)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Column_Name</th>
<th align="right">NA_Count</th>
<th align="right">Total_Rows</th>
<th align="left">NA_Percentage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">id</td>
<td align="right">0</td>
<td align="right">5400</td>
<td align="left">0%</td>
</tr>
<tr class="even">
<td align="left">study_interval</td>
<td align="right">0</td>
<td align="right">5400</td>
<td align="left">0%</td>
</tr>
<tr class="odd">
<td align="left">day_in_study</td>
<td align="right">0</td>
<td align="right">5400</td>
<td align="left">0%</td>
</tr>
<tr class="even">
<td align="left">timeinbed_mean</td>
<td align="right">0</td>
<td align="right">5400</td>
<td align="left">0%</td>
</tr>
<tr class="odd">
<td align="left">deep_sleep_in_minutes</td>
<td align="right">324</td>
<td align="right">5400</td>
<td align="left">6%</td>
</tr>
<tr class="even">
<td align="left">sleep_score</td>
<td align="right">322</td>
<td align="right">5400</td>
<td align="left">5.96%</td>
</tr>
<tr class="odd">
<td align="left">stress_score</td>
<td align="right">1659</td>
<td align="right">5400</td>
<td align="left">30.72%</td>
</tr>
</tbody>
</table>
</div>
<div id="exercise_daily---daily-exercise-related-data"
class="section level2">
<h2><code>exercise_daily</code> - Daily Exercise Related Data</h2>
<p><em>Overview:</em></p>
<p>The <code>exercise_daily</code> dataframe contains participants’
daily exercise related data from <code>exercise.csv</code>).</p>
<p>It contains a total of 1744 observations of 12 variables. Some key
variables are the following:</p>
<ul>
<li><code>id</code>: participant’s unique identifier</li>
<li><code>study_interval</code>: the year of study that participant
enrolled in 2022 or 2024)</li>
<li><code>day_in_study</code>: normalized day index starting from day 1
of each participant’s study interval</li>
<li>Exercise session logs data:
<ul>
<li>Numeric data like <code>total_duration_min</code> (amount of time
spent in active movement during the session in minutes),
<code>total_steps</code> (total number of steps recorded),
<code>total_calores</code> (total calories burned), heart rate data
(<code>avg_heartrate</code> and <code>max_heartrate</code>)</li>
<li>Categorical data like <code>activity_types</code> (e.g. sport,
walk)</li>
</ul></li>
<li><code>n_sessions</code>: numeric indicator of how many exercise
sessions a participant had per day</li>
</ul>
<p><em>Steps:</em></p>
<ol style="list-style-type: decimal">
<li><p>Deduplicated any exact duplicate rows present in the raw exercise
data (exercise_raw) using <code>distinct()</code>.</p></li>
<li><p>Aggregated each participant’s daily data.</p>
<ol style="list-style-type: decimal">
<li>Calculated key daily metrics like total sums of calories, duration,
steps, and elevation gain. Converted the units from milliseconds to
minutes.</li>
<li>Calculated the average and maximum heart rate.</li>
<li>Counted the number sessions per day.</li>
<li>Concatenated list of all activity types.</li>
</ol></li>
<li><p>Renamed the aggregation key <code>start_day_in_study</code> to
<code>day_in_study</code> for standardization.</p></li>
<li><p>Check data completeness. <strong>Noted only a small amount of
missing heart rate data in
<code>exercise_daily</code>.</strong></p></li>
</ol>
<pre class="r"><code>sanity_check(exercise_daily)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Column_Name</th>
<th align="right">NA_Count</th>
<th align="right">Total_Rows</th>
<th align="left">NA_Percentage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">id</td>
<td align="right">0</td>
<td align="right">1744</td>
<td align="left">0%</td>
</tr>
<tr class="even">
<td align="left">study_interval</td>
<td align="right">0</td>
<td align="right">1744</td>
<td align="left">0%</td>
</tr>
<tr class="odd">
<td align="left">day_in_study</td>
<td align="right">0</td>
<td align="right">1744</td>
<td align="left">0%</td>
</tr>
<tr class="even">
<td align="left">total_calories</td>
<td align="right">0</td>
<td align="right">1744</td>
<td align="left">0%</td>
</tr>
<tr class="odd">
<td align="left">total_duration_min</td>
<td align="right">0</td>
<td align="right">1744</td>
<td align="left">0%</td>
</tr>
<tr class="even">
<td align="left">total_active_min</td>
<td align="right">0</td>
<td align="right">1744</td>
<td align="left">0%</td>
</tr>
<tr class="odd">
<td align="left">total_steps</td>
<td align="right">0</td>
<td align="right">1744</td>
<td align="left">0%</td>
</tr>
<tr class="even">
<td align="left">avg_heartrate</td>
<td align="right">6</td>
<td align="right">1744</td>
<td align="left">0.34%</td>
</tr>
<tr class="odd">
<td align="left">max_heartrate</td>
<td align="right">6</td>
<td align="right">1744</td>
<td align="left">0.34%</td>
</tr>
<tr class="even">
<td align="left">total_elevation</td>
<td align="right">0</td>
<td align="right">1744</td>
<td align="left">0%</td>
</tr>
<tr class="odd">
<td align="left">n_sessions</td>
<td align="right">0</td>
<td align="right">1744</td>
<td align="left">0%</td>
</tr>
<tr class="even">
<td align="left">activity_types</td>
<td align="right">0</td>
<td align="right">1744</td>
<td align="left">0%</td>
</tr>
</tbody>
</table>
</div>
<div id="all_daily_data---merged-multimodal-daily-data"
class="section level2">
<h2><code>all_daily_data</code> - Merged Multimodal Daily Data</h2>
<p><em>Overview:</em></p>
<p>The <code>all_daily_data</code> is a merged multimodal dataframe that
contains all <strong>daily-level</strong> data from
<code>hormone_symptoms</code>, <code>exercise_daily</code>, and
<code>sleep_stress_daily</code> dataframes.</p>
<p>It contains a total of 5659 observations of 50 variables, with unique
combination of key identifiers (<code>id</code>,
<code>study_interval</code>, and <code>day_in_study</code>). Additional
flag variables that are not in 3 multimodal dataframes are
<code>exercise_flag</code> and <code>sleep_stress_flag</code> to
indicate if the observation day had at least one recorded exercise
session or if both stress and sleep scores are present.</p>
<p><em>Steps:</em></p>
<p>We used <code>hormone_symptoms</code> as our anchor dataframe since
all of our outcome variables are from <code>hormone_symptoms</code>;
hence, we used <code>left_join()</code> on it. In other words, if a
person did not have any hormone/symptoms related data on a given day,
she would not have any other types of data on that day (e.g. no
exercise/stress/sleep) in the merged dataset called
<code>all_daily_data</code>.</p>
<p>So now in this <code>all_daily_data</code>, each row represents a
daily data for a person in a specific study year (including sleep score,
stress score, daily exercise data, hormone and self-reported
symptoms).</p>
<ol style="list-style-type: decimal">
<li>Merged <code>exercise_daily</code>
<ol style="list-style-type: decimal">
<li>Left joined <code>exercise_daily</code> onto
<code>hormone_symptoms</code>.</li>
<li>Set a <code>exercised_flag</code> to indicate if the observation day
had at least one recorded exercise session (<code>1</code> = Yes,
<code>0</code> = No).</li>
</ol></li>
<li>Merged <code>sleep_stress_daily</code>.
<ol style="list-style-type: decimal">
<li>Noted that the initial <code>hormone_symptoms</code> data contains a
<code>stress_score</code> column. Dropped it before performing a second
left join to avoid redundant columns.</li>
<li>Left joined the processed <code>sleep_stress_daily</code> data using
the same identifiers.</li>
<li>Set a <code>sleep_stress_flag</code> to <code>1</code> only if both
the <code>stress_score</code> and <code>sleep_score</code> are present
for that observation day, and <code>0</code> otherwise.</li>
</ol></li>
</ol>
<pre class="r"><code>all_daily_data &lt;- hormone_symptoms |&gt; 
  # MERGE exercise &amp; hormone
  left_join(exercise_daily, by = c(&quot;id&quot;, &quot;study_interval&quot;, &quot;day_in_study&quot;)) |&gt;
  # add flag exercised_flag for easy filtering in the future analyses
  # only need to keep exercised_flag==1 to have all rows with exercise data
  mutate(
    exercised_flag = ifelse(!is.na(n_sessions) &amp; n_sessions &gt; 0, 1, 0)
  ) |&gt; 
  # MERGE sleep &amp; stress score data
  # noticed hormone_symptoms df has a stress_score column 
  # drop it
  select(-stress_score) |&gt; 
  left_join(sleep_stress_daily, by = c(&quot;id&quot;, &quot;study_interval&quot;, &quot;day_in_study&quot;)) |&gt; 
  # add flag sleep_stress_flag for easy filtering in the future analyses
  mutate(
    sleep_stress_flag = ifelse(
      !is.na(stress_score) &amp; !is.na(sleep_score),1,0
    )
  )  
  # MERGE demographic data
  # left_join(subject_info, by = c(&quot;id&quot;, &quot;study_interval&quot;)) </code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Check data completeness. The result should not be surprising as it
is a aggregated results from previous sanity checks.</li>
</ol>
<pre class="r"><code>sanity_check(all_daily_data)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Column_Name</th>
<th align="right">NA_Count</th>
<th align="right">Total_Rows</th>
<th align="left">NA_Percentage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">id</td>
<td align="right">0</td>
<td align="right">5659</td>
<td align="left">0%</td>
</tr>
<tr class="even">
<td align="left">study_interval</td>
<td align="right">0</td>
<td align="right">5659</td>
<td align="left">0%</td>
</tr>
<tr class="odd">
<td align="left">is_weekend</td>
<td align="right">0</td>
<td align="right">5659</td>
<td align="left">0%</td>
</tr>
<tr class="even">
<td align="left">day_in_study</td>
<td align="right">0</td>
<td align="right">5659</td>
<td align="left">0%</td>
</tr>
<tr class="odd">
<td align="left">phase</td>
<td align="right">1</td>
<td align="right">5659</td>
<td align="left">0.02%</td>
</tr>
<tr class="even">
<td align="left">lh</td>
<td align="right">320</td>
<td align="right">5659</td>
<td align="left">5.65%</td>
</tr>
<tr class="odd">
<td align="left">estrogen</td>
<td align="right">321</td>
<td align="right">5659</td>
<td align="left">5.67%</td>
</tr>
<tr class="even">
<td align="left">pdg</td>
<td align="right">3795</td>
<td align="right">5659</td>
<td align="left">67.06%</td>
</tr>
<tr class="odd">
<td align="left">flow_volume</td>
<td align="right">2567</td>
<td align="right">5659</td>
<td align="left">45.36%</td>
</tr>
<tr class="even">
<td align="left">flow_color</td>
<td align="right">2617</td>
<td align="right">5659</td>
<td align="left">46.24%</td>
</tr>
<tr class="odd">
<td align="left">appetite</td>
<td align="right">2329</td>
<td align="right">5659</td>
<td align="left">41.16%</td>
</tr>
<tr class="even">
<td align="left">exerciselevel</td>
<td align="right">2329</td>
<td align="right">5659</td>
<td align="left">41.16%</td>
</tr>
<tr class="odd">
<td align="left">headaches</td>
<td align="right">2339</td>
<td align="right">5659</td>
<td align="left">41.33%</td>
</tr>
<tr class="even">
<td align="left">cramps</td>
<td align="right">2332</td>
<td align="right">5659</td>
<td align="left">41.21%</td>
</tr>
<tr class="odd">
<td align="left">sorebreasts</td>
<td align="right">2332</td>
<td align="right">5659</td>
<td align="left">41.21%</td>
</tr>
<tr class="even">
<td align="left">fatigue</td>
<td align="right">2328</td>
<td align="right">5659</td>
<td align="left">41.14%</td>
</tr>
<tr class="odd">
<td align="left">sleepissue</td>
<td align="right">2330</td>
<td align="right">5659</td>
<td align="left">41.17%</td>
</tr>
<tr class="even">
<td align="left">moodswing</td>
<td align="right">2339</td>
<td align="right">5659</td>
<td align="left">41.33%</td>
</tr>
<tr class="odd">
<td align="left">stress</td>
<td align="right">2339</td>
<td align="right">5659</td>
<td align="left">41.33%</td>
</tr>
<tr class="even">
<td align="left">foodcravings</td>
<td align="right">2332</td>
<td align="right">5659</td>
<td align="left">41.21%</td>
</tr>
<tr class="odd">
<td align="left">indigestion</td>
<td align="right">2334</td>
<td align="right">5659</td>
<td align="left">41.24%</td>
</tr>
<tr class="even">
<td align="left">bloating</td>
<td align="right">2331</td>
<td align="right">5659</td>
<td align="left">41.19%</td>
</tr>
<tr class="odd">
<td align="left">appetite_score</td>
<td align="right">2329</td>
<td align="right">5659</td>
<td align="left">41.16%</td>
</tr>
<tr class="even">
<td align="left">exerciselevel_score</td>
<td align="right">2329</td>
<td align="right">5659</td>
<td align="left">41.16%</td>
</tr>
<tr class="odd">
<td align="left">headaches_score</td>
<td align="right">2339</td>
<td align="right">5659</td>
<td align="left">41.33%</td>
</tr>
<tr class="even">
<td align="left">cramps_score</td>
<td align="right">2332</td>
<td align="right">5659</td>
<td align="left">41.21%</td>
</tr>
<tr class="odd">
<td align="left">sorebreasts_score</td>
<td align="right">2332</td>
<td align="right">5659</td>
<td align="left">41.21%</td>
</tr>
<tr class="even">
<td align="left">fatigue_score</td>
<td align="right">2328</td>
<td align="right">5659</td>
<td align="left">41.14%</td>
</tr>
<tr class="odd">
<td align="left">sleepissue_score</td>
<td align="right">2330</td>
<td align="right">5659</td>
<td align="left">41.17%</td>
</tr>
<tr class="even">
<td align="left">moodswing_score</td>
<td align="right">2339</td>
<td align="right">5659</td>
<td align="left">41.33%</td>
</tr>
<tr class="odd">
<td align="left">foodcravings_score</td>
<td align="right">2332</td>
<td align="right">5659</td>
<td align="left">41.21%</td>
</tr>
<tr class="even">
<td align="left">indigestion_score</td>
<td align="right">2334</td>
<td align="right">5659</td>
<td align="left">41.24%</td>
</tr>
<tr class="odd">
<td align="left">bloating_score</td>
<td align="right">2331</td>
<td align="right">5659</td>
<td align="left">41.19%</td>
</tr>
<tr class="even">
<td align="left">flow_volume_score</td>
<td align="right">2567</td>
<td align="right">5659</td>
<td align="left">45.36%</td>
</tr>
<tr class="odd">
<td align="left">flow_color_score</td>
<td align="right">2617</td>
<td align="right">5659</td>
<td align="left">46.24%</td>
</tr>
<tr class="even">
<td align="left">total_calories</td>
<td align="right">3915</td>
<td align="right">5659</td>
<td align="left">69.18%</td>
</tr>
<tr class="odd">
<td align="left">total_duration_min</td>
<td align="right">3915</td>
<td align="right">5659</td>
<td align="left">69.18%</td>
</tr>
<tr class="even">
<td align="left">total_active_min</td>
<td align="right">3915</td>
<td align="right">5659</td>
<td align="left">69.18%</td>
</tr>
<tr class="odd">
<td align="left">total_steps</td>
<td align="right">3915</td>
<td align="right">5659</td>
<td align="left">69.18%</td>
</tr>
<tr class="even">
<td align="left">avg_heartrate</td>
<td align="right">3921</td>
<td align="right">5659</td>
<td align="left">69.29%</td>
</tr>
<tr class="odd">
<td align="left">max_heartrate</td>
<td align="right">3921</td>
<td align="right">5659</td>
<td align="left">69.29%</td>
</tr>
<tr class="even">
<td align="left">total_elevation</td>
<td align="right">3915</td>
<td align="right">5659</td>
<td align="left">69.18%</td>
</tr>
<tr class="odd">
<td align="left">n_sessions</td>
<td align="right">3915</td>
<td align="right">5659</td>
<td align="left">69.18%</td>
</tr>
<tr class="even">
<td align="left">activity_types</td>
<td align="right">3915</td>
<td align="right">5659</td>
<td align="left">69.18%</td>
</tr>
<tr class="odd">
<td align="left">exercised_flag</td>
<td align="right">0</td>
<td align="right">5659</td>
<td align="left">0%</td>
</tr>
<tr class="even">
<td align="left">timeinbed_mean</td>
<td align="right">280</td>
<td align="right">5659</td>
<td align="left">4.95%</td>
</tr>
<tr class="odd">
<td align="left">deep_sleep_in_minutes</td>
<td align="right">583</td>
<td align="right">5659</td>
<td align="left">10.3%</td>
</tr>
<tr class="even">
<td align="left">sleep_score</td>
<td align="right">581</td>
<td align="right">5659</td>
<td align="left">10.27%</td>
</tr>
<tr class="odd">
<td align="left">stress_score</td>
<td align="right">1918</td>
<td align="right">5659</td>
<td align="left">33.89%</td>
</tr>
<tr class="even">
<td align="left">sleep_stress_flag</td>
<td align="right">0</td>
<td align="right">5659</td>
<td align="left">0%</td>
</tr>
</tbody>
</table>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
